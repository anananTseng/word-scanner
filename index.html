<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ç”Ÿå­—æƒç„æ©Ÿ</title>
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    <style>
        body { font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif; text-align: center; background-color: #f4f4f9; padding: 10px; }
        h2 { color: #333; }
        video { width: 90%; max-width: 400px; border: 4px solid #FFD700; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        #result-area { display: none; margin-top: 20px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .big-char { font-size: 80px; color: #d32f2f; margin: 10px 0; }
        button { font-size: 20px; padding: 12px 24px; border-radius: 50px; border: none; margin: 8px; cursor: pointer; width: 80%; max-width: 300px;}
        .btn-scan { background-color: #007bff; color: white; font-weight: bold; }
        .btn-speak { background-color: #28a745; color: white; }
        .btn-dict { background-color: #ff9800; color: white; }
        #status { color: #666; margin-top: 10px; }
    </style>
</head>
<body>

    <h2>ğŸ” è°æ˜ç”Ÿå­—æƒç„æ©Ÿ</h2>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>
    
    <p id="status">æ­£åœ¨å•Ÿå‹•ç›¸æ©Ÿ...</p>
    <button class="btn-scan" onclick="snapAndRecognize()">ğŸ“¸ æ‹ç…§è¾¨è­˜</button>

    <div id="result-area">
        <div>è¾¨è­˜çµæœï¼š</div>
        <div id="detected-char" class="big-char">?</div>
        
        <button class="btn-speak" onclick="speakText()">ğŸ”Š è½è½æ€éº¼å”¸</button>
        <br>
        <button class="btn-dict" onclick="openDict()">ğŸ“– æŸ¥è§£é‡‹èˆ‡é€ è©</button>
        <br><br>
        <button onclick="location.reload()" style="background:#ddd; color:#333;">ğŸ”„ é‡æ–°æƒæ</button>
    </div>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const statusText = document.getElementById('status');
        const resultArea = document.getElementById('result-area');
        let finalChar = "";

        // å•Ÿå‹•å¾Œé¡é ­
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
            .then(stream => { video.srcObject = stream; statusText.innerText = "è«‹å°‡å­—æ”¾åœ¨æ¡†æ¡†ä¸­é–“"; })
            .catch(err => { statusText.innerText = "ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿï¼Œè«‹å…è¨±æ¬Šé™"; });

        function snapAndRecognize() {
            statusText.innerText = "â³ åŠªåŠ›è¾¨è­˜ä¸­ï¼Œè«‹ç¨ç­‰...";
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);

            Tesseract.recognize(
                canvas,
                'chi_tra', // ç¹é«”ä¸­æ–‡
                { logger: m => console.log(m) }
            ).then(({ data: { text } }) => {
                // éæ¿¾é›œè¨Šï¼ŒåªæŠ“ä¸­æ–‡
                let cleanText = text.replace(/[^\u4e00-\u9fa5]/g, "");
                if(cleanText.length > 0) {
                    finalChar = cleanText.substring(0, 1); // åªå–ç¬¬ä¸€å€‹å­—
                    showResult(finalChar);
                } else {
                    statusText.innerText = "âŒ æ²’çœ‹åˆ°å­—è€¶ï¼Œè«‹å°æº–æ¸…æ¥šä¸€é»";
                }
            });
        }

        function showResult(char) {
            statusText.innerText = "âœ… æŠ“åˆ°äº†ï¼";
            resultArea.style.display = "block";
            document.getElementById('detected-char').innerText = char;
        }

        function speakText() {
            let u = new SpeechSynthesisUtterance(finalChar);
            u.lang = 'zh-TW';
            u.rate = 0.8; // ç¨å¾®æ…¢ä¸€é»çµ¦å°æœ‹å‹è½
            speechSynthesis.speak(u);
        }

        function openDict() {
            // è·³è½‰åˆ°èŒå…¸æŸ¥è©¢è©²å­—
            window.open(`https://www.moedict.tw/${finalChar}`, '_blank');
        }
    </script>
</body>
</html>
